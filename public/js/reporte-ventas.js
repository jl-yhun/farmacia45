var table;$(document).ready((function(){const a=moment().startOf("day"),e=moment().endOf("day");var t=$('input[name="fechas"]');t.daterangepicker({startDate:a,endDate:e,locale:{format:"YYYY-MM-DD",separator:" / ",applyLabel:"Aplicar",cancelLabel:"Cancelar",fromLabel:"De",toLabel:"a",customRangeLabel:"Otro",weekLabel:"SEMANA",daysOfWeek:["Do","Lu","Ma","Mi","Ju","Vi","Sa"],monthNames:["Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre"],firstDay:0},ranges:{Hoy:[a,e],"Esta semana":[moment().startOf("week"),moment().endOf("week")],"-1 semana":[moment().startOf("week").subtract(7,"days"),moment().endOf("week").subtract(7,"days")],"-2 semanas":[moment().startOf("week").subtract(14,"days"),moment().endOf("week").subtract(14,"days")],"-3 semanas":[moment().startOf("week").subtract(21,"days"),moment().endOf("week").subtract(21,"days")],"-4 semanas":[moment().startOf("week").subtract(28,"days"),moment().endOf("week").subtract(28,"days")],"-5 semanas":[moment().startOf("week").subtract(35,"days"),moment().endOf("week").subtract(35,"days")]}}),t.on("apply.daterangepicker",(function(a,e){table.ajax.reload()})),table=$("#table").DataTable({ajax:{url:$("#urlReportar").val(),type:"POST",data:function(a){var e=t.data("daterangepicker");a.startDate=e.startDate.format("YYYY-MM-DD"),a.endDate=e.endDate.format("YYYY-MM-DD")},dataSrc:""},columns:[{data:"id",name:"id"},{data:null,render:crearProductos,name:"productos"},{data:"total",name:"total"},{data:"denominacion",name:"denominacion"},{data:"cambio",name:"cambio"},{data:"utilidad",name:"utilidad"},{data:"created_at_formated",name:"created_at"},{data:null,render:crearAcciones,targets:[-1]}],createdRow:function(a,e,t){-1!=e.garantias.findIndex((a=>"CANCELACIÓN"==a.tipo))&&$(a).addClass("bg-danger").addClass("text-white")}}),$("#btnExport").on("click",(function(){var a=t.data("daterangepicker"),e=a.startDate.format("YYYY-MM-DD"),r=a.endDate.format("YYYY-MM-DD");location.href=`/t/${e}/${r}`}))})),$(document).on("click",".btnReimprimir",(function(a){a.preventDefault();var e=$(this).attr("data-id");imprimirTicketVenta({id:e,fromPtv:!1},(function(){alerta("Se ha impreso el ticket","success")}),(function(){alerta("No se pudo imprimir el ticket, consulte con soporte","danger")}))}));var crearProductos=function(a){for(var e="",t=0;t<a.productos.length;t++){var r=a.productos[t];e+=`<li><a href="/productos?q=${r.codigo_barras}">${r.pivot.cantidad} ${r.nombre} <br><sup>${r.descripcion}</sup></a></li>`}return`<ul class="px-0">${e}</ul>`},crearAcciones=function(a){return-1!=a.garantias.findIndex((a=>"CANCELACIÓN"==a.tipo))?"CANCELADA":`<a class='btn btn-warning btnReimprimir' data-id='${a.id}'><i class='fa fa-print'></i></a>`};
